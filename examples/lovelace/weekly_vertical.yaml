# Weekly Meal Plan - Vertical Grid Layout
# This card displays your weekly meal schedule in a vertical format
# with each day as a row showing all meal times horizontally.
#
# Installation:
# 1. Copy this entire configuration
# 2. Go to your Lovelace dashboard in edit mode
# 3. Click "Add Card" -> "Manual" (or edit raw configuration)
# 4. Paste the configuration below
# 5. Adjust the entity ID if your sensor has a different name

type: custom:vertical-stack-in-card
cards:
  # Header Card with Week Information
  - type: markdown
    content: |
      # üìÖ This Week's Meals
      **{{ state_attr('sensor.meal_planner_week', 'start') | as_timestamp | timestamp_custom('%B %d', true) }} - {{ state_attr('sensor.meal_planner_week', 'end') | as_timestamp | timestamp_custom('%B %d, %Y', true) }}**
    card_mod:
      style: |
        ha-card {
          background: var(--primary-color);
          color: var(--text-primary-color);
          font-weight: 500;
          padding: 8px 16px;
          box-shadow: none;
        }
        ha-markdown {
          padding: 0 !important;
        }
        h1 {
          font-size: 1.5em;
          margin: 0 0 4px 0;
        }

  # Vertical Day-by-Day Grid
  - type: markdown
    content: |
      {% set days_data = state_attr('sensor.meal_planner_week', 'days') %}
      {% set day_order = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'] %}
      {% set today = now().strftime('%a').lower() %}

      <style>
        .vertical-meal-grid {
          width: 100%;
          border-collapse: collapse;
          font-size: 0.9em;
        }
        .vertical-meal-grid th {
          background: var(--secondary-background-color);
          color: var(--primary-text-color);
          padding: 10px 12px;
          font-weight: 600;
          text-align: left;
          border: 1px solid var(--divider-color);
          white-space: nowrap;
        }
        .vertical-meal-grid td {
          padding: 10px 12px;
          border: 1px solid var(--divider-color);
          background: var(--card-background-color);
        }
        .vertical-meal-grid td.day-cell {
          background: var(--primary-color);
          color: var(--text-primary-color);
          font-weight: 600;
          width: 120px;
          text-align: center;
        }
        .vertical-meal-grid td.day-cell.today {
          background: var(--accent-color);
          box-shadow: inset 0 0 0 2px var(--primary-color);
        }
        .day-label {
          font-size: 1.1em;
          display: block;
        }
        .day-date {
          font-size: 0.8em;
          opacity: 0.9;
          font-weight: normal;
          display: block;
          margin-top: 2px;
        }
        .meal-content {
          color: var(--primary-text-color);
          font-weight: 500;
        }
        .empty-meal-content {
          color: var(--secondary-text-color);
          font-style: italic;
          font-size: 0.85em;
        }
        .meal-icon {
          margin-right: 6px;
        }
        @media (max-width: 768px) {
          .vertical-meal-grid {
            font-size: 0.8em;
          }
          .vertical-meal-grid th,
          .vertical-meal-grid td {
            padding: 8px 6px;
          }
        }
      </style>

      <table class="vertical-meal-grid">
        <thead>
          <tr>
            <th style="width: 120px;">Day</th>
            <th><span class="meal-icon">üåÖ</span>Breakfast</th>
            <th><span class="meal-icon">‚òÄÔ∏è</span>Lunch</th>
            <th><span class="meal-icon">üåô</span>Dinner</th>
            <th><span class="meal-icon">üçø</span>Snack</th>
          </tr>
        </thead>
        <tbody>
          {% for day in day_order %}
            {% set day_info = days_data[day] %}
            {% set is_today = (day == today[:3]) %}
            <tr>
              <td class="day-cell{% if is_today %} today{% endif %}">
                <span class="day-label">{{ day_info.label }}</span>
                <span class="day-date">{{ day_info.date | as_timestamp | timestamp_custom('%b %d', true) if day_info.date }}</span>
              </td>
              <td>
                {% if day_info.breakfast and day_info.breakfast != '' %}
                  <span class="meal-content">{{ day_info.breakfast }}</span>
                {% else %}
                  <span class="empty-meal-content">No meal planned</span>
                {% endif %}
              </td>
              <td>
                {% if day_info.lunch and day_info.lunch != '' %}
                  <span class="meal-content">{{ day_info.lunch }}</span>
                {% else %}
                  <span class="empty-meal-content">No meal planned</span>
                {% endif %}
              </td>
              <td>
                {% if day_info.dinner and day_info.dinner != '' %}
                  <span class="meal-content">{{ day_info.dinner }}</span>
                {% else %}
                  <span class="empty-meal-content">No meal planned</span>
                {% endif %}
              </td>
              <td>
                {% if day_info.snack and day_info.snack != '' %}
                  <span class="meal-content">{{ day_info.snack }}</span>
                {% else %}
                  <span class="empty-meal-content">-</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    card_mod:
      style: |
        ha-card {
          padding: 16px;
          overflow-x: auto;
        }

  # Summary Statistics
  - type: markdown
    content: |
      {% set days_data = state_attr('sensor.meal_planner_week', 'days') %}
      {% set day_order = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'] %}
      {% set total_meals = 0 %}
      {% set planned_meals = 0 %}

      {% for day in day_order %}
        {% set day_info = days_data[day] %}
        {% for meal_type in ['breakfast', 'lunch', 'dinner', 'snack'] %}
          {% set total_meals = total_meals + 1 %}
          {% if day_info[meal_type] and day_info[meal_type] != '' %}
            {% set planned_meals = planned_meals + 1 %}
          {% endif %}
        {% endfor %}
      {% endfor %}

      {% set completion = ((planned_meals / total_meals) * 100) | round(0) | int %}

      <style>
        .stats-container {
          display: flex;
          justify-content: space-around;
          align-items: center;
          padding: 12px;
          background: var(--secondary-background-color);
          border-radius: 8px;
        }
        .stat-item {
          text-align: center;
        }
        .stat-value {
          font-size: 1.8em;
          font-weight: bold;
          color: var(--primary-color);
        }
        .stat-label {
          font-size: 0.85em;
          color: var(--secondary-text-color);
          margin-top: 4px;
        }
        .progress-bar {
          width: 100%;
          height: 8px;
          background: var(--divider-color);
          border-radius: 4px;
          overflow: hidden;
          margin-top: 8px;
        }
        .progress-fill {
          height: 100%;
          background: var(--success-color);
          transition: width 0.3s ease;
        }
      </style>

      <div class="stats-container">
        <div class="stat-item">
          <div class="stat-value">{{ planned_meals }}</div>
          <div class="stat-label">Meals Planned</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ total_meals - planned_meals }}</div>
          <div class="stat-label">Slots Empty</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ completion }}%</div>
          <div class="stat-label">Complete</div>
        </div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: {{ completion }}%;"></div>
      </div>
    card_mod:
      style: |
        ha-card {
          padding: 12px;
          box-shadow: none;
        }

  # Quick Actions Footer
  - type: horizontal-stack
    cards:
      - type: button
        name: Clear Week
        icon: mdi:delete-sweep
        tap_action:
          action: call-service
          service: meal_planner.clear_week
          data: {}
        hold_action:
          action: none
        card_mod:
          style: |
            ha-card {
              background: var(--warning-color);
              opacity: 0.8;
            }

      - type: button
        name: Add Meal
        icon: mdi:plus-circle
        tap_action:
          action: call-service
          service: meal_planner.add
          data:
            name: "New Meal"
            meal_time: "Dinner"
        hold_action:
          action: none
        card_mod:
          style: |
            ha-card {
              background: var(--success-color);
              opacity: 0.8;
            }

# ALTERNATIVE: Without card_mod (for users without card_mod installed)
# Replace the entire configuration above with this simpler version:
#
# type: vertical-stack
# cards:
#   - type: markdown
#     content: |
#       # üìÖ This Week's Meals
#       **{{ state_attr('sensor.meal_planner_week', 'start') | as_timestamp | timestamp_custom('%B %d', true) }} - {{ state_attr('sensor.meal_planner_week', 'end') | as_timestamp | timestamp_custom('%B %d, %Y', true) }}**
#
#   - type: markdown
#     content: |
#       {% set days_data = state_attr('sensor.meal_planner_week', 'days') %}
#       {% set day_order = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'] %}
#
#       | Day | üåÖ Breakfast | ‚òÄÔ∏è Lunch | üåô Dinner | üçø Snack |
#       |-----|-------------|---------|----------|---------|
#       {% for day in day_order %}
#       {% set day_info = days_data[day] %}
#       | **{{ day_info.label }}** | {{ day_info.breakfast if day_info.breakfast else '-' }} | {{ day_info.lunch if day_info.lunch else '-' }} | {{ day_info.dinner if day_info.dinner else '-' }} | {{ day_info.snack if day_info.snack else '-' }} |
#       {% endfor %}
#
#   - type: entities
#     entities:
#       - entity: sensor.meal_planner_week
#         name: Week Range
#       - entity: sensor.meal_planner_potential
#         name: Potential Meals
