# Weekly Meal Plan - Horizontal Grid Layout
# This card displays your weekly meal schedule in a horizontal grid format
# with days as columns and meal times as rows.
#
# Installation:
# 1. Copy this entire configuration
# 2. Go to your Lovelace dashboard in edit mode
# 3. Click "Add Card" -> "Manual" (or edit raw configuration)
# 4. Paste the configuration below
# 5. Adjust the entity ID if your sensor has a different name

type: custom:vertical-stack-in-card
cards:
  # Header Card with Week Information
  - type: markdown
    content: |
      # üçΩÔ∏è Weekly Meal Plan
      **{{ state_attr('sensor.meal_planner_week', 'start') | as_timestamp | timestamp_custom('%B %d', true) }} - {{ state_attr('sensor.meal_planner_week', 'end') | as_timestamp | timestamp_custom('%B %d, %Y', true) }}**
    card_mod:
      style: |
        ha-card {
          background: var(--primary-color);
          color: var(--text-primary-color);
          font-weight: 500;
          padding: 8px 16px;
          box-shadow: none;
        }
        ha-markdown {
          padding: 0 !important;
        }
        h1 {
          font-size: 1.5em;
          margin: 0 0 4px 0;
        }

  # Meal Grid Card
  - type: markdown
    content: |
      {% set days_data = state_attr('sensor.meal_planner_week', 'days') %}
      {% set day_order = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'] %}
      {% set meal_times = [
        {'key': 'breakfast', 'icon': 'üåÖ', 'label': 'Breakfast'},
        {'key': 'lunch', 'icon': '‚òÄÔ∏è', 'label': 'Lunch'},
        {'key': 'dinner', 'icon': 'üåô', 'label': 'Dinner'},
        {'key': 'snack', 'icon': 'üçø', 'label': 'Snack'}
      ] %}

      <style>
        .meal-grid {
          width: 100%;
          border-collapse: collapse;
          font-size: 0.9em;
        }
        .meal-grid th {
          background: var(--primary-color);
          color: var(--text-primary-color);
          padding: 12px 8px;
          font-weight: 600;
          text-align: center;
          border: 1px solid var(--divider-color);
        }
        .meal-grid th.meal-time {
          background: var(--secondary-background-color);
          color: var(--primary-text-color);
          width: 100px;
          text-align: left;
          padding-left: 12px;
        }
        .meal-grid td {
          padding: 10px 8px;
          border: 1px solid var(--divider-color);
          text-align: center;
          vertical-align: middle;
          background: var(--card-background-color);
          min-height: 60px;
        }
        .meal-grid td.meal-time {
          background: var(--secondary-background-color);
          font-weight: 500;
          text-align: left;
          padding-left: 12px;
        }
        .meal-name {
          color: var(--primary-text-color);
          font-weight: 500;
        }
        .empty-meal {
          color: var(--secondary-text-color);
          font-style: italic;
          font-size: 0.85em;
        }
        .today-column {
          background: var(--primary-color) !important;
          opacity: 0.1;
        }
        .day-header {
          font-size: 0.95em;
        }
        .day-date {
          font-size: 0.8em;
          opacity: 0.8;
          font-weight: normal;
          display: block;
          margin-top: 2px;
        }
      </style>

      <table class="meal-grid">
        <thead>
          <tr>
            <th class="meal-time">Meal</th>
            {% for day in day_order %}
              {% set day_info = days_data[day] %}
              <th class="day-header">
                {{ day_info.label }}
                <span class="day-date">{{ day_info.date | as_timestamp | timestamp_custom('%m/%d', true) if day_info.date }}</span>
              </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for meal in meal_times %}
            <tr>
              <td class="meal-time">{{ meal.icon }} {{ meal.label }}</td>
              {% for day in day_order %}
                {% set day_info = days_data[day] %}
                {% set meal_value = day_info[meal.key] %}
                <td>
                  {% if meal_value and meal_value != '' %}
                    <span class="meal-name">{{ meal_value }}</span>
                  {% else %}
                    <span class="empty-meal">-</span>
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    card_mod:
      style: |
        ha-card {
          padding: 16px;
          overflow-x: auto;
        }

  # Quick Actions Footer
  - type: horizontal-stack
    cards:
      - type: button
        name: Clear Week
        icon: mdi:delete-sweep
        tap_action:
          action: call-service
          service: meal_planner.clear_week
          data: {}
        hold_action:
          action: none
        card_mod:
          style: |
            ha-card {
              background: var(--warning-color);
              opacity: 0.8;
            }

      - type: button
        name: Add Meal
        icon: mdi:plus-circle
        tap_action:
          action: call-service
          service: meal_planner.add
          data:
            name: "New Meal"
            meal_time: "Dinner"
        hold_action:
          action: none
        card_mod:
          style: |
            ha-card {
              background: var(--success-color);
              opacity: 0.8;
            }

# ALTERNATIVE: Without card_mod (for users without card_mod installed)
# Replace the entire configuration above with this simpler version:
#
# type: vertical-stack
# cards:
#   - type: markdown
#     content: |
#       # üçΩÔ∏è Weekly Meal Plan
#       **Week of {{ state_attr('sensor.meal_planner_week', 'start') | as_timestamp | timestamp_custom('%B %d, %Y', true) }}**
#
#   - type: markdown
#     content: |
#       {% set days_data = state_attr('sensor.meal_planner_week', 'days') %}
#       {% set day_order = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'] %}
#
#       | Meal | {% for day in day_order %}{{ days_data[day].label }} | {% endfor %}
#       |------|{% for day in day_order %}:---:|{% endfor %}
#       | üåÖ **Breakfast** | {% for day in day_order %}{{ days_data[day].breakfast if days_data[day].breakfast else '-' }} | {% endfor %}
#       | ‚òÄÔ∏è **Lunch** | {% for day in day_order %}{{ days_data[day].lunch if days_data[day].lunch else '-' }} | {% endfor %}
#       | üåô **Dinner** | {% for day in day_order %}{{ days_data[day].dinner if days_data[day].dinner else '-' }} | {% endfor %}
#       | üçø **Snack** | {% for day in day_order %}{{ days_data[day].snack if days_data[day].snack else '-' }} | {% endfor %}
